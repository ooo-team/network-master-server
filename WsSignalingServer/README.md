# WebSocket Signaling Server

WebSocket сигналинг-сервер для WebRTC соединений с поддержкой комнат.

## Структура проекта

```
├── main.go          # Главный файл для запуска сервера
├── server.go        # WebSocket сервер и обработка соединений
├── room.go          # Управление комнатами
├── peer.go          # Управление пирами
├── types.go         # Типы данных
├── go.mod           # Зависимости Go
├── test.html        # HTML страница для тестирования
└── README.md        # Этот файл
```

## Установка и запуск

1. Убедитесь, что у вас установлен Go 1.21 или выше
2. Установите зависимости:
   ```bash
   go mod tidy
   ```
3. Запустите сервер:
   ```bash
   go run .
   ```

Сервер запустится на порту 8080 (или на порту, указанном в переменной окружения `SIGNALING_ADDR`).

## Использование

### WebSocket Endpoint

```
ws://localhost:8080/ws?peer_id=YOUR_ID&room=ROOM_CODE
```

### Параметры подключения

- `peer_id` - уникальный идентификатор пира
- `room` - код комнаты для подключения

### Типы сообщений

Сервер поддерживает следующие типы сообщений:

- `offer` - WebRTC offer
- `answer` - WebRTC answer  
- `ice_candidate` - ICE candidate
- `peer_joined` - уведомление о присоединении пира
- `peer_left` - уведомление об уходе пира

### Формат сообщений

```json
{
  "type": "offer",
  "from": "peer1",
  "to": "peer2",
  "payload": {
    "sdp": "...",
    "timestamp": 1234567890
  }
}
```

## Тестирование

1. Запустите сервер: `go run .`
2. Откройте `test.html` в браузере
3. Подключите два пира к одной комнате
4. Отправляйте тестовые сообщения между пирами

### Тестирование через websocat

```bash
# Подключение первого пира
websocat ws://localhost:8080/ws?peer_id=peer1&room=test-room

# Подключение второго пира (в другом терминале)
websocat ws://localhost:8080/ws?peer_id=peer2&room=test-room
```

### Пример сообщения для отправки

```json
{"type":"offer","from":"peer1","to":"peer2","payload":{"sdp":"mock-sdp","timestamp":1234567890}}
```

## Логирование

Сервер выводит подробные логи в консоль:
- Подключения/отключения пиров
- Создание/удаление комнат
- Пересылка сообщений
- Ошибки

## Архитектура

- **PeerManager** - управляет подключенными пирами
- **RoomManager** - управляет комнатами и рассылкой сообщений
- **SignalingServer** - основной WebSocket сервер
- **Peer** - представляет подключенного клиента
- **Room** - представляет комнату с пирами

## Безопасность

⚠️ **Внимание**: В текущей версии для разработки отключена проверка origin. Для продакшена необходимо настроить `CheckOrigin` в `upgrader`. 